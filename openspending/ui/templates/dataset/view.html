<html xmlns:py="http://genshi.edgewall.org/"
  xmlns:i18n="http://genshi.edgewall.org/i18n"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  py:strip="">
  
  <xi:include href="_nav.html" />
  
  <py:def function="nav_class">nav-dataset</py:def>

  <py:def function="page_title">${c.dataset.label or c.dataset.name}</py:def>

  <py:def function="optional_head">
    <!-- templates/dataset/view.html optional_head -->
    <!-- TODO: Load this from the widget itself. -->
    <link py:if="hasattr(c, 'widget')" rel="stylesheet" href="${c.widget.base}/css/${c.widget.name}.css" type="text/css" />
  </py:def>

  <py:def function="page_description()">${h.markdown_preview(c.dataset.description)}</py:def>

  <py:def function="scripts">
    <!-- templates/dataset/view.html scripts -->
    <script type="text/javascript" src="http://localhost/openspendingjs/lib/embed.js"></script>


    <script py:if="hasattr(c, 'widget')" type="text/javascript" src="${c.widget.js}"></script>
    <script py:if="hasattr(c, 'widget')">
        var context = {
            dataset: '${c.dataset.name}',
            siteUrl: '${h.site_url()}',
            time: '${c.time}'
            };

        (function ($) {
            var widget = new ${c.widget.class_name}($('#widget'), context, ${c.viewjson});
            
            widget.then(function(w) {
              var embedder = new OpenSpending.Embedder(w, context, '${c.widget.name}');  
              $("#embed-link").click(function(e) {
                embedder.render();
                return false;
              });
            });
        })(jQuery);
    </script>
    ${share_scripts()}
  </py:def>

  <div py:def="content">
    ${dataset_nav(c.view.name if c.view else 'search')}

    <!-- templates/dataset/view.html content -->

    <div py:if="c.view" class="row">
      <div class="span12"><div id="widget" style="width: auto; height: 400px"/></div>
    </div>
    <a href="" id="embed-link">Embed</a>

    <div py:if="c.view" class="row">
      <div class="span12">
        <div id="detail" />
      </div>
    </div>

    ${share_body()}
  </div>

  <xi:include href="../layout.html" />
</html>

