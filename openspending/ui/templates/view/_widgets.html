<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:i18n="http://genshi.edgewall.org/i18n"
  xmlns:py="http://genshi.edgewall.org/"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  py:strip=""
  >
  <xi:include href="../_util.html" />  

  <py:def function="widget_elem(widget)" py:if="widget">
    <!-- templates/view/_widgets.html widget_elem -->
    <div id="widget"></div>
  </py:def>

  <py:def function="widget_js(widget, state, time, handles=False)" py:if="widget">
    <!-- templates/view/_widgets.html widget_js -->
    <script type="text/javascript" src="http://localhost/openspendingjs/lib/widgets.js"></script>
    <script type="text/javascript" src="http://localhost/openspendingjs/app/bob/bob.js"></script>
    <script type="text/javascript" src="${widget.js}"></script>
    <script defer="defer">
        var state = ${h.json.dumps(state, indent=2)};
        var context = {
            dataset: "${c.dataset.name}",
            siteUrl: "${h.site_url()}",
            time: "${time}"
            };

        $(function() {
            window.widget = new ${widget.class_name}($('#widget'), context, state);
            ${handles_js(widget) if handles else ''}
        });
    </script>
  </py:def>

  <py:def function="handles_js(widget)">
    window.widget.then(function(w) {
      var embedder = new OpenSpending.Widgets.Embedder(w, context, '${c.widget.name}');  
      $("#widget-embed-link").click(function(e) {
        embedder.render();
        return false;
      });
      $("#widget-edit-link").click(function(e) {
        w.configure(null);
        return false;
      });
    });
  </py:def>

</html>



