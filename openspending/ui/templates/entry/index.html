<html xmlns:py="http://genshi.edgewall.org/"
  xmlns:i18n="http://genshi.edgewall.org/i18n"
  xmlns:xi="http://www.w3.org/2001/XInclude" py:strip="">

  <xi:include href="../dataset/_nav.html" />
  <py:def function="nav_class">nav-dataset</py:def>

  <py:def function="page_title">${c.dataset.label}</py:def>

  <div py:def="content">
    <!-- templates/entry/index.html -->
    ${dataset_nav('search')}

    <xi:include href="../_browser.html" />
  </div>

  <py:def function="optional_head">
    ${style_tag('lib/vendor/datatables/css/jquery.dataTables')}
  </py:def>

  <py:def function="scripts">
    ${script_tag('lib/vendor/datatables/js/jquery.dataTables')}
    ${script_tag('app/data_table/openspending.data_table')}
    <script>
      OpenSpending.$(function() {
        window.table = new OpenSpending.DataTable(
          document.getElementById('os_datatable'),
          {
            sorting: [[3, 'desc']], // Initial sort: amount desc
            columnDefs: [
              { aTargets: [0], mDataProp: 'time.name' },
              { aTargets: [1], mDataProp: 'from.label' },
              { aTargets: [2], mDataProp: 'to.label' },
              {
                aTargets: [3],
                mDataProp: function (data) {
                  return OpenSpending.Utils.formatAmountWithCommas(data.amount);
                }
              },
              {
                aTargets: [4],
                bSortable: false,
                mDataProp: function (data) {
                  return '<a href="/${c.dataset.name}/entries/' +  data.id + '">details&raquo;</a>'
                }
              }
            ],
            defaultParams: { dataset: "${c.dataset.name}" }
          }
        );

        // Set up filters
        $('.filter').live('click', function () {
          $(this).removeClass('filter')
                 .addClass('unfilter')
                 .parents('tr')
                 .siblings().hide();

          table.addFilter($(this).attr('data-key'), $(this).attr('data-value'));
          table.draw();

          return false;
        });

        $('.unfilter').live('click', function () {
          $(this).removeClass('unfilter')
                 .addClass('filter')
                 .parents('tr')
                 .siblings().show();

          table.removeFilter($(this).attr('data-key'));
          table.draw();

          return false;
        });
      });
    </script>
  </py:def>

  <xi:include href="../layout.html" />
</html>
